<!DOCTYPE HTML>
<!--
	Synchronous by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)-->
<html>
	<head>
<!-- TITLE -->
		<title>Adiv Paradise | COVID-19 Data Documentation</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="css/reset.css">
		<link rel="icon" type='image/x-icon' href="imgs/planeticon.ico">
        <!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-panels.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel-noscript.css" />
			<link rel="stylesheet" href="css/style.css" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->

       <style>
      /* NOTE: The styles were added inline because Prefixfree needs access to your styles and they must be inlined if they are on local disk! */
      /*body { background: #000; font-family: 'Open Sans', sans-serif; -webkit-font-smoothing: antialiased; font-smoothing: antialiased; background-image: url('https://i.imgur.com/n4O2kR2.jpg'); }*/

/* -- Table of Contents -- */

#tableOfContents {
    width: 300px;
    color: #fff !important;
    background: #222;
    float: left;
    position: fixed;
    bottom: 0;
    right: 1%;
    z-index: 11;
    font-size: 18px;
    font-weight: normal;
    opacity:0.95;
}

#tableOfContents h2 {
    padding: 0;
    font-size: 20px;
    font-weight: 700;
    width: 100%;
    margin: 0 !important;
    line-height: 26px;
    z-index: 10;
    background: #5c0929;
    position: relative;
}

#tableofContents:hover {
  background: #a32f59;
}

#tableOfContents h2 a {
    
    background: url("imgs/tocarrow.png") no-repeat top left;
    padding: 10px 0 10px 50px;
    width: 250px;
    display: block;
}

#tableOfContents h2 a:hover {
    background: #a32f59; 
}

#tableOfContents a {
    color: #fff;
    text-decoration: none;
    width: 260px;
    padding: 6px 10px;
    margin: 0;
    display: block;
}

#tableOfContents a:hover {
    background: #8194d1;
    color:#000000;
}

.sectionsWrapper {
    padding-left: 40px;
    background: transparent;
    position: absolute;
    width: 260px;
    bottom: -200px;
    visibility: hidden;
}

#tableOfContents dl {
    margin: 0;
    overflow: hidden;
    background: #002a5c;
    padding: 0 0 20px 0;
    width: 260px;
    z-index: 10;
}

#tableOfContents dt {
    padding: 0;
    font-weight: 550;
}

.subsectionContent {
    display: none;
}

.subsectionContent dd a {
    /*color: #eee !important;*/
    color: #000000;
    padding-left: 25px !important;
    font-weight: 500;
    background: #002a5c;
}


.flex-container {
  display: flex;
}

.column {
  flex: 48%;
  padding: 5px;
}


    </style>

    <script src="js/prefixfree.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

  <!--  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.61.0/lib/codemirror.min.css">
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.61.0/addon/runmode/runmode-standalone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.61.0/mode/python/python.min.js"></script>
 

	</head>
	<body>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code1");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code2");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code3");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code4");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code5");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code6");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code7");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code8");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code9");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>
    <script type="text/javascript">
        window.onload = function(){
            var codeElement = document.getElementById("python_code10");
            // Add code mirror class for coloring (default is the theme)
            codeElement.classList.add( 'cm-s-default' );
            var code = codeElement.innerText;

            codeElement.innerHTML = "";

            CodeMirror.runMode(
              code,
              'python',
              codeElement
            );
        };
    </script>-->
    
<!--    <div class="globalWrapper">
        <div id="tableOfContents">
        <h2><a id="toc" href="#">Table of Contents</a></h2>
        <div class="sectionsWrapper closed">
        <dl class="sections">-->
<!-- TOC -->
<!--          <dt><a class="subsection" href="#ChemTag">1. PhD Research</a></dt>
            <div class="subsectionContent">
              <dd><a href="#habz" data=""-offset="70">1.1. Tidally-locked Planets</a></dd>
              <dd><a href="#stability" data=""-offset="70">1.2. Climate stability</a></dd>
              <dd><a href="#observ" data=""-offset="70">1.2. Observability</a></dd>
            </div>
          <dt><a class="subsection" href="#Other">2. Past Research</a></dt>
            <div class="subsectionContent">
              <dd><a href="#blocking" data=""-offset="80">2.1. Atmospheric Blocking</a></dd>
              <dd><a href="#chime" data=""-offset="80">2.2. CHIME FRB</a></dd>
              <dd><a href="#implicit" data=""-offset="80">2.3. Implicit Fluid Transport</a></dd>
              <dd><a href="#poisson" data=""-offset="80">2.4. Poisson Solver</a></dd>
              <dd><a href="#solarwind" data=""-offset="80">2.5. Solar Wind</a></dd>
            </div>
           <dt><a class="subsection" href="#Pub">3. Publications</a></dt>
            <div class="subsectionContent">
              <dd><a href="#first" data=""-offset="80">3.1. First Author</a></dd>
              <dd><a href="#author" data=""-offset="80">3.2. Author</a></dd>
              <dd><a href="#draft" data=""-offset="80">3.3. Drafts</a></dd>
            </div>-->
        <!--</dl>--><!-- / sections -->
        <!--</div>--><!-- / sectionsWrapper -->
      <!--</div>--><!-- / tableOfContents -->
      <!--</div>-->
</head>
<body>

	  <div class="globalWrapper">
        <div id="tableOfContents">
        <h2><a id="toc" href="#">Table of Contents</a></h2>
        <div class="sectionsWrapper closed">
        <dl class="sections">
          <dt><a class="subsection" href="#"> COVID-19 Dashboard</a></dt>
          	<div class="subsectionContent">
              <dd><a href="index.html#Toronto" data=""-offset="70">Toronto</a></dd>
              <dd><a href="index.html#Ontario" data=""-offset="70">Ontario</a></dd>
              <dd><a href="index.html#Canada" data=""-offset="70">Canada</a></dd>
              <dd><a href="index.html#USA" data=""-offset="70">USA</a></dd>
              <dd><a href="index.html#Global" data=""-offset="70">Global</a></dd>
            </div>
          <dt><a class="subsection" href="#"> Data and Scripts</a></dt>
              <div class="subsectionContent">
                <dd><a href="data.html" data =""-offset="70">How to Use</a></dd>
              </div>
          <dt><a class="subsection" href="#"> COVID-19 Maps and Videos</a></dt>
          	<div class="subsectionContent">
              <dd><a href="maps.html#Toronto" data=""-offset="70">Greater Toronto Area</a></dd>
              <dd><a href="maps.html#SOntario" data=""-offset="70">Southern Ontario</a></dd>
              <dd><a href="maps.html#GreatLakes" data=""-offset="70">Great Lakes</a></dd>
              <dd><a href="maps.html#NA" data=""-offset="70">North America</a></dd>
              <dd><a href="maps.html#Global" data=""-offset="70">Global</a></dd>
            </div>
          <dt><a class="subsection" href="#"> Main Page</a></dt>
          	<div class="subsectionContent">
              <dd><a href="https://adivparadise.ca/index.html" data=""-offset="70">Homepage</a></dd>
              <dd><a href="https://adivparadise.ca/research.html" data=""-offset="70">Research</a></dd>
              <dd><a href="https://adivparadise.ca/extracurriculars.html" data=""-offset="70">Extracurriculars</a></dd>
              <dd><a href="https://adivparadise.ca/outreach.html" data=""-offset="70">Outreach</a></dd>
              <dd><a href="https://adivparadise.ca/cv_dossier.html" data=""-offset="70">CV/Resume</a></dd>
            </div>
        </dl><!-- / sections -->
        </div><!-- / sectionsWrapper -->
      </div><!-- / tableOfContents -->
      </div>

        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

        <script src="js/index.js"></script>

		<div id="wrapper">
			
			<!-- Header -->
			<div id="header">
				<div class="container"> 
					
					<!-- Logo -->
					<div id="logo">
						<h1><a href="https://adivparadise.ca/index.html">Adiv Paradise</a></h1>
						<span>Astrophysicist | Climate Scientist | Programmer | Storyteller</span>
					</div>
					
					<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="https://adivparadise.ca/index.html">Homepage</a></li>
<!-- NAVBAR -->
<!-- <li class="active"><a href="currentpage.html">currentpage</a></li> -->
							<li><a href="https://covid19.adivparadise.ca/index.html">COVID-19 Dashboard</a></li>
                                        <li><a href="maps.html">COVID-19 Maps and Videos</a></li>
						</ul>
						</ul>
					</nav>
					<br/>
					<nav id="nav">
                                        <ul>
                                        <li><a href="index.html#Toronto">Toronto</a></li>
                                        <li><a href="index.html#Ontario">Ontario</a></li>
                                        <li><a href="index.html#Canada">Canada</a></li>
                                        <li><a href="index.html#USA">USA</a></li>
                                        <li><a href="index.html#Global">Global</a></li>
                                        <li><a class="active" href="data.html">Data</a></li>
                                        </ul>
                                        </nav>
				</div>
			</div>
			<!-- /Header -->

            <script>
            $(function () {
    setIFrameSize();
    $(window).resize(function () {
        setIFrameSize();
    });
});

function setIFrameSize() {
    var ogWidth = 960;
    var ogHeight = 596;
    var ogRatio = ogWidth / ogHeight;

    var parentDivWidth = $(".iframe-class").parent().width();
    var newHeight = (parentDivWidth / ogRatio);
    $(".iframe-class").addClass("iframe-class-resize");
    $(".iframe-class-resize").css("width", parentDivWidth);
    $(".iframe-class-resize").css("height", newHeight);
}
</script>
			
<div id="page">
        <div class="container">
                <div class="row">
                        <div class="9u skel-cell-important">
                                <section id="content" >
                             
                                <header>
<!-- HEADER -->
<!--                                         <h2><a name="current">PhD Research</a></h2> -->
                                <h2><a name="current">Using the HDF5 Datasets</a></h2>
                                </header>
                                <p style="font-size:25px">Important Disclaimers</p>
                                <ul style="font-weight:bold;list-style-type:disc;">
                                <li>I am not an epidemiologist. I may get things wrong, and you should not use my analyses as predictive tools or for policy decisions.<br/><br/></li>
                                <li>I am providing access to data along with some basic mathematical and statistical manipulations of said data, packaged into visualizations I think are useful. I am not making predictions about where the pandemic is headed next.<br/><br/></li>
                                <li>Data on small populations are inherently more uncertain. Take any data product for local scales such as counties, neighborhoods, small states, etc with some hefty grains of salt.<br/><br/></li>
                                <li>These analyses are always retrospective. There is a known lag between when someone gets sick and when the databases find out about it, often several days to a week. When things are getting worse, assume they're worse than the data reveal. When they're getting better, however, assume you don't know what's actually going on, because there could be a growth in cases happening that hasn't shown up in the data yet. Additionally, many of my measures make use of rolling averages or running sums, which will also tend to increase the degree to which the analysis lags the real world. Where possible I use the center of the rolling window for the associated timestamp, which reduces the lag effect for historical data, but for recent data it absolutely still applies.<br/><br/></li>
                                <li>The data are always incomplete. Not everyone who gets covid gets recorded in the databases, because some people are asymptomatic and have no idea they're infected, some tested positive on an at-home rapid test and just immediately isolated and never went and got a PCR test, or they got sick and just never got tested at all.<br/><br/></li>
                                <li>Vaccination reduces the severity of infection. My analyses focus on case numbers, but there will come a point where that stops being a useful measure of the severity of an outbreak, because people won't get hospitalized or die from covid anymore.<br/><br/></li>
                                </ul>
                                <br/><br/><br/>
                                <p style="font-size:25px">My Data and Methodology Sources</p>
                                <p>For Toronto and Ontario data, I source my data directly from the respective public health authorities. Canadian public health region data is sourced from the COVID-19 Canada Open Data Working Group. For US and global data, I use the John's Hopkins COVID-19 Dashboard github repository.</p>
                                <ul style="list-style-type:disc">
                                <li><a target="_blank" href="https://github.com/CSSEGISandData/COVID-19">COVID-19 Data Repository by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University</a><br/><br/></li>
                                <li><a target="_blank" href="https://data.ontario.ca/dataset/1115d5fe-dd84-4c69-b5ed-05bf0c0a0ff9/resource/d1bfe1ad-6575-4352-8302-09ca81f7ddfc">Status of COVID-19 cases in Ontario by Public Health Unit (PHU) - Ontario Data Catalogue</a><br/><br/></li>
                                <li><a target="_blank" href="https://github.com/ccodwg/Covid19Canada">Epidemiological Data from the COVID-19 Outbreak in Canada, COVID-19 Canada Open Data Working Group</a><br/><br/></li>
                                <li><a target="_blank" href="https://ckan0.cf.opendata.inter.prod-toronto.ca/dataset/covid-19-cases-in-toronto">Toronto Public Health COVID-19 Cases</a><br/><br/></li>
                                <li>R<sub>t</sub> is computed using the Bayesian method described in <a target="_blank" href="https://doi.org/10.1101/2020.06.02.20120188">Yap & Yong (2020)</a><br/><br/></li>
                                </ul>
                                <p>I have repackaged the data from the various datasets into a hierarchical data format (HDF-5) that is available to download using the links on the right-hand side of the page. These datasets contain data all formatted the same way, with similar reference patterns, from national to local scales. The datasets also include my R<sub>t</sub> values, along with the posterior probability distributions and likelihood functions (this accounts for the bulk of the dataset's size). A slim version that omits the posteriors and likelihoods is also available.</p>
                                <p>A shapefile is also now available, which has identical naming conventions as the locations in the HDF5 file. No COVID-19 data is stored in the shapefile, only location names, shape data, and coordinates, but the HDF5 and shapefiles can be used together to map the data. A Python script is also provided which contains a routine for performing the merge using a GeoPandas GeoDataFrame. The script requires Pandas, GeoPandas, numpy, and h5py.</p>
<!-- BODY -->
                            <br>
                                <h2>Accessing the HDF5 Datasets with h5py</h2>
                                <br>
                                <p>My preferred way to access data is via Python, and while the Hierarchical Data Format is language-agnostic and can be accessed in many different languages, I am most familiar with the Python bindings via the <a href="https://pypi.org/project/h5py/" target="_blank">h5py library</a>. A short primer on accessing and plotting data from my datasets in Python using <a href="https://matplotlib.org/" target="_blank">matplotlib</a> is shown below.</p>
                                <br>
                                <h3>Opening the file and accessing variables</h3><br>
                                <p>First we'll start a python interpreter, import the h5py library, open a file, and extract the cases timeseries for the state of Ohio (I'm just picking a random location here). Remember that once a file has been opened, it is in use until either it is closed or the Python interpreter exits.</p>
                            
<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-bsh">$ python</code></pre>
<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code1">import h5py as h5

hfile = h5.File("adivparadise_covid19data_slim.hdf5","r")
ohio_cases = hfile["United States/Ohio/cases"][:]
</code></pre>

<p>Note that we needed to use the <code style="all:revert; font-size:small" class="prettyprint lang-py">[:]</code> slice operator to retrieve the data from the file; this is because h5py will not load data into memory unless it is explicitly asked to--this is very important for large datasets. The <code style="all:revert; font-size:small" class="prettyprint lang-py">[:]</code> operator tells h5py to retrieve all the data from the variable; we could also have specified that only a portion should be read.</p>
<p>Note as well that the dataset has a hierarchical structure, similar to a file tree (this is in fact where the format's name, "Hierarchical Data Format", comes from). The datasets are structured by geographical units, so Ohio is housed within the United States, and individual Ohio counties are housed with Ohio. For example, Fulton County, Ohio, could be accessed with <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code2">hfile["United States/Ohio/Fulton/cases"][:]</code>.</p>
<p>Note as well that we had to specify that we wanted <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code3">"cases"</code>. This is because for each geographical unit, there are multiple variables you could access. <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code4">hfile["United States/Ohio"]</code> on its own is a <b>group</b>, within which you may find variables as well as other groups, such as the Fulton County group.</p>
<p>To get a list of all the variables and groups contained within a group, we can use h5py's <code style="all:revert; font-size:small">visit</code> function:</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code5">def printname(name):
   print(name)
   
hfile.visit(printname)
</code></pre>

<p>The <code style="all:revert; font-size:small">printname</code> routine we defined is iteratively called over everything in the file's hierarchy, and simply receives the name of each variable or group and prints it to the standard output. We can also use this for specific groups within the larger dataset:</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code6">
hfile["United States/Ohio"].visit(printname)


</pre></code>

<p>Every group is guaranteed to have at minimum <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code7">"cases"</code>, <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code8">"Rt"</code> (the effective reproductive number), and <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code9">"latestdate"</code>, the latest date for which data was found in the source dataset (John's Hopkins for US and global data, Ontario Public Health for Ontario public health units (PHUs), and Toronto Public Health for Toronto neighborhoods). Some groups may have more data, such as deaths, hospitalizations, population, active cases per day, and in the non-slim file, the posterior distributions and likelihood functions for the R<sub>t</sub> values.</p>
<br>
    <h3>An example: plotting the 7-day average cases per 100k for the United Kingdom</h3><br>
    
<p>For this example, we will need <a href="https://matplotlib.org/" target="_blank">matplotlib</a> as well as <a href="https://numpy.org/install/" target="_blank">numpy</a>, the latter of which will be used to compute the 7-day average using the <code style="all:revert; font-size:small" class="prettyprint lang-py" id="python_code">numpy.convolve</code> function.</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">import numpy as np
import matplotlib.pyplot as plt

cases = hfile["United Kingdom/cases"][:]
population = hfile["United Kingdom/population"][()]
latest_date = hfile["United Kingdom/latestdate"][()]

cases_per_100k = cases/population * 1.0e5 #Multiply by 100k to get cases per 100k

cases_per_100k_7day = np.convolve(cases_per_100k,np.ones(7),'valid')/7.0

days_before = np.arange(len(cases_per_100k_7day)) - len(cases_per_100k_7day) #max value is now 0

#Create the plot
fig,axes = plt.subplots(figsize=(14,8))
axes.plot(days_before, cases_per_100k_7day)
axes.set_xlabel("Days before "+latest_date)
axes.set_ylabel("7-day Average of Daily Cases per 100k")
axes.set_title("Average Daily cases for the UK as of "+latest_date)
plt.show()
</code></pre>

<p>Note that for the population and latest date, we had to use <code style="all:revert; font-size:small" class="prettyprint lang-py">[()]</code> instead of <code style="all:revert; font-size:small" class="prettyprint lang-py">[:]</code>. This is because those variables have only a single value each. Trying to use the latter would have returned an error. The <code style="all:revert; font-size:small" class="prettyprint lang-py">np.arange</code> function generated a list of integers from 1 to the number given (the length of the averaged cases list), and then we subtracted the maximum value to get a list that represented the number of days before the latest date in the data, which we used for our X-axis.</p>
                              
<p>This produces a plot that might look like the following:</p>

     
                                <br>
                                
                                <div class="image full">
                                    <img src="UK_example.png" alt="Example of UK 7-day average daily cases">
                                </div>
                                <br>
                                
                                
                            <br>
                                <h2>Mapping the data</h2>
                                <br>
                                
<p>Along with the HDF5 datasets, I have also made available a <a href="unified.zip" download>shapefile</a> that combines geometries for all the different locales included in the HDF5 file, labeled in the same form as their HDF5 counterparts. A Python script, <a href="covid_utlities.py" download>covid_utilities.py</a>, is also available, which contains a routine to merge the HDF5 datasets and the shapefile into a <a href="https://geopandas.org/en/stable/index.html" target="_blank">GeoPandas</a> <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.html" target="_blank">GeoDataFrame</a>. This can then be used to produce maps of the data, such as those found on the <a href="maps.html">Maps and Videos</a> page. The script also computes some derivative quantities that may be useful, such as the 7-day average cases and 7-day average deaths, the 21-day rolling sum of both cases and deaths (to match the 'recent cases' metric used by Toronto Public Health), and the cumulative case and death counts. Note that the R<sub>t</sub> posterior and likelihood distributions are <em>not</em> merged into the GeoDataFrame, as this would consume enormous amounts of RAM, and so only the 'slim' dataset is needed. Two basic mapping examples are shown below.</p>

<br>
    <h3>Example 1: Cumulative Global Cases</h3><br>
                                
<p>In this example, we'll map the recent cumulative total cases per capita for the smallest jurisdictions in the dataset (so the maximum level of geographical detail possible), given as a percent of the population that has been infected. Note that this is not strictly the true exposure rate; not only do many people get infected and never test positive on a recorded test (either because they didn't get tested at all, or used an at-home test), but many people also get reinfected. So not only are many cases missed by this metric, but there's some doubling as well. Nonetheless, it's an interesting look at the pandemic's overall spread.</p>


<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">import covid_utilities as cvu
import geopandas as gpd
import matplotlib.pyplot as plt
import numpy as np

pandemic = cvu.unify_files("adivparadise_covid19data_slim.hdf5","unified/unified.shp")
</code></pre>

<p>In order to merge the shapefile and HDF5 file, we simply have to provide the path to each to the unifying routine. It will return a GeoDataFrame with a MultiIndex, such that it can be indexed at any of the the four geographic levels (Country, State, Region, and Area; the latter corresponding to neighborhood-level data in Toronto), as well as by date.</p>

                                <div class="image full">
                                    <img src="head1.png" alt="merged GeoDataFrame head output">
                                </div>
<p>You can see here that for national-level data, the subnational index labels are simply "NaN" ("Not a Number"). There are also a number of other columns that may be of interest, including "Deepest", which indicates if a row belongs to the deepest level of geographical precision available for that part of the dataset's tree, and "Path", which gives the path to the corresponding data in the HDF5 file.</p>

<div class="image full">
  <img src="head2.png" alt="Indexed GeoDataFrame head output showing only the contents for the University neighborhood in Toronto, Ontario, Canada">
</div>

<p>Because the GeoDataFrame is MultiIndexed, subsets can be queried based on their levels in the tree hierarchy. For example, the above shows a selection that will return all rows corresponding to the University neighborhood in Toronto, Ontario, Canada. In many cases, however, we will simply want to keep all the data and look at a single point in time, in which case only the Time index concerns us.</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">times = sorted(pandemic.index.unique(4))
pandemic = pandemic.reset_index().set_index("Time")
</code></pre>

<p>Here we extract a sorted list of dates found in the dataset, and then reset the GeoDataFrame so that the only index is time. Now we'll select only the rows corresponding to the level of maximum geographic detail, where the "Deepest" column is equal to 1 (and not 0). Then, we'll calculate a new derived column to normalize the cumulative cases by population:</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">deepest = pandemic.loc[pandemic["Deepest"]==1]
deepest["cum_cases_per"] = deepest["cum_cases"]/deepest["Population"] * 100.0
</code></pre>

<p>We can now plot the data using GeoPandas's built-in plot function for GeoDataFrames, which relies on <a href="https://matplotlib.org/" target="_blank">matplotlib</a>:</p>
<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">ax = deepest.loc[times[-2]].plot(column="cum_cases_per",cmap='inferno',figsize=(18,10),aspect=None,
                               antialiased=False,linewidth=0,edgecolor='none',legend=True,
                               legend_kwds={'label': "Cumulative Confirmed COVID-19 Cases [% of Population]",
                                            'orientation': "vertical",
                                            'pad': 0.01},
                               vmin=0,vmax=50)
ax.set_facecolor("#b8d6e3")
ax.set_xlabel("Longitude [deg]")
ax.set_ylabel("Latitude [deg]")
ax.set_xlim(-180,180)
ax.set_ylim(-60,88)
plt.title("COVID-19 Global Spread\nAs of %s"%times[-2],size=18)
plt.show()
</code></pre>
<div class="image full">
  <img src="example_map1.png" alt="Map of cumulative global cases as a percent of population at maximum geographic detail, for February 9, 2022">
</div>
<p>Note that the time index we used was the <em>second-to-last</em> index--this is because the latest date available is not necessarily uniform across the dataset. In most cases, -2 or -3 is the most recent index that can be used.</p>


<br>
    <h3>Example 2: Cumulative Toronto Cases</h3><br>
      
<p>In addition to examining global data, perhaps a smaller region may be of interest. Here, we'll select and plot only Toronto data, following many of the same steps as before.</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">import covid_utilities as cvu
import geopandas as gpd
import matplotlib.pyplot as plt
import numpy as np

pandemic = cvu.unify_files("adivparadise_covid19data_slim.hdf5","unified/unified.shp")
times = sorted(pandemic.index.unique(4))
pandemic = pandemic.reset_index().set_index("Time")
deepest = pandemic.loc[pandemic["Deepest"]==1]
deepest["cum_cases_per"] = deepest["cum_cases"]/deepest["Population"] * 100.0
toronto = deepest.loc[deepest["Region"]=="Toronto"]
</code></pre>

<p>Here we have once again reset the index so that only "Time" is used as an index, but we can still select the Toronto data using the "Region" column. We could have also selected the Toronto data at a much earlier stage using the MultiIndex, as shown earlier, but then if we wanted to examine multiple regions, we would have to calculate the cumulative cases per capita each time. The total work would be the same each time, but the code would ultimately appear less clean.</p>

<p>Once we have the Toronto data, we can plot it just like before:</p>

<pre style="all:revert; background-color:#e6e6e6; font-size:small"><code class="prettyprint lang-py" id="python_code10">ax = toronto.loc[times[-3]].plot(column="cum_cases_per",cmap='magma',
                                 figsize=(18,10),aspect=None,legend=True,
                                 legend_kwds={'label': "Cumulative Confirmed COVID-19 Cases [% of Population]",
                                              'orientation': "horizontal",
                                              'pad': 0.01},
                                 vmin=0,vmax=25)
ax.set_axis_off()
plt.title("COVID-19 Spread in Toronto\nAs of %s"%times[-3],size=18)
plt.show()
</code></pre>
<div class="image full">
  <img src="example_map2.png" alt="Map of cumulative cases in Toronto as a percent of population at maximum geographic detail, for February 8, 2022">
</div>

<p>Note that this time, we needed to use -3 as the index, rather than -2. This is because the Toronto neighborhood-level data is less recent than the surrounding locales. That technically means that there was no data plotted for Toronto in the previous example, but due to the geographical scale of the map, the missing data was not noticeable.</p>

                                
                                
                                </section>
                        </div>
                        
-						<div class="3u"> 
							<section id="sidebard2">
								<header>
									<h2>Download Data</h2>
								</header>
								<ul class="style1">
								<li><a href="adivparadise_covid19data_slim.hdf5" download>HDF5 (Slim)</a></li>
								<li><a href="adivparadise_covid19data.hdf5" download>HDF5</a></li>
								<li><a href="unified.zip" download>Shapefile</a></li>
								<li><a href="covid_utilities.py" download>GeoPandas Integration Script</a></li>
								<li>How to Use</li>
								</ul>
                                                        </section>
                                                </div>
<!--                        <div class="3u"> 
                                <section id="sidebard2">
                                        <header>
                                                <h2>Links</h2>
                                        </header>
                                    <ul class="style1">
                                    <li><a target="_blank" href="https://www.linkedin.com/in/adivparadise/">LinkedIn</a></li>
                                    <li><a target="_blank" href="https://github.com/alphaparrot/">GitHub</a></li>
                                    <li><script language="JavaScript">
                                        var username = "paradise.astro";
                                        var hostname = "gmail.com";
                                        var linktext = username + "@" + hostname ;
                                        document.write("<a href='" + "mailto:" + username + "@" + hostname + "'>Email</a>");
                                    </script></li>

                                </ul>
                                    <br>
                                    <br>
                                    <header>
                                        <h2>Selected Projects</h2>
                                    </header>
                                    <ul class="style1">
                                    <li><a target="_blank" href="https://exoplasim.readthedocs.io/en/latest/">ExoPlaSim</a></li>
                                    <li><a target="_blank" href="https://github.com/alphaparrot/crawler2">Crawler<sub>2</sub></a></li>
                                    <li><a target="_blank" href="https://github.com/alphaparrot/GCMscope">GCMscope</a></li>
                                    <li><a target="_blank" href="https://github.com/alphaparrot/gcmtools">gcmtools</a></li>
                                    <li><a target="_blank" href="https://github.com/alphaparrot/NagMe">NagMe</a></li>
                                    </ul>
                                </section>
                        </div>-->
                </div>

        </div>	
    </div>

<!-- Footer -->
            <div id="footer">
                <div class="container">
                    <div class="row">
                        <div class="3u">
                            <section id="box1">
                                <header>
                                    <h2>Recent travel</h2>
                                </header>
                                <ul class="style3">
                                    <li class="first">
                                        <p class="date"> Aug 19-23 2019</p>
                                        <p><a href="https://sites.northwestern.edu/iceland2019/">Extreme Solar Systems IV</a> - Reykjavik, Iceland </p>
                                    </li>
                                    <li>
                                        <p class="date">Jun 17-19 2019</p>
                                        <p><a href="https://eres.astro.cornell.edu/">Emerging Researchers in Exoplanet Science V</a> - Cornell University, Ithaca</p>
                                    </li>
                                </ul>
                            </section>
                        </div>
                        <div class="6u">
                            <section id="box2">
                                <header>
                                    <h2>Department of Astronomy</h2>
                                </header>
                                <div> <a href="https://www.astro.utoronto.ca/" class="image full"><img src="imgs/gasa_nov2017.jpg" style="width:90%" alt=""></a> </div>
                                <p>I did my PhD at the <a target="_blank" href="https://www.astro.utoronto.ca/">Department of Astronomy & Astrophysics </a> at the University of Toronto.</p>
                            </section>
                        </div>
                        <div class="3u">
                            <section id="box3">
                                <header>
                                    <h2>External Links</h2>
                                </header>
                                <ul class="style1">
                                    <li class="first"><a href="https://universe.utoronto.ca/talks-lectures/ask-an-astronomer/" target=_"blank">Ask an Astronomer</a>
                                    <a href="https://www.astro.utoronto.ca/astrotours/" target="_blank">AstroTours</a>
                                    <a href="https://astro.utoronto.ca/~gasa/" target="_blank">GASA</a>
                                    <a target="_blank" href="https://www.linkedin.com/in/adivparadise/">My LinkedIn</a>
                                    <a href="https://github.com/alphaparrot/">My GitHub</a>
                                    <script language="JavaScript">
                                        var username = "paradise";
                                        var hostname = "astro.utoronto.ca";
                                        var linktext = username + "@" + hostname ;
                                        document.write("<a href='" + "mailto:" + username + "@" + hostname + "'>My Email</a>");
                                    </script></li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Copyright -->
            <div id="copyright">
                <div class="container">
                    Copyright Adiv Paradise 2018; Design: <a href="https://templated.co">TEMPLATED</a> ; Banner image: <a href="https://eol.jsc.nasa.gov/">Earth Science and Remote Sensing Unit, NASA Johnson Space Center</a>
                </div>
            </div>
            
        </div>
    </body>
</html>

